<div x-data="{ 
          templatePreview: false, 
          iframeReady: false,
          url: 'about:blank',
          changeURL: function(url){
            this.iframeReady=false;
            this.url = url;
          },
          changeTheme: function(slug, url){
            window.dispatchEvent(new CustomEvent('change-template', { detail : { slug: slug }}));
            this.url = 'about:blank';
            let that = this;
            setTimeout(function(){
                that.changeURL(url);
                console.log('change');
                console.log(slug);
            }, 100);
          },
          templateInstallCommand(){
            if(activeTemplate.slug == 'starter'){
                return 'static new project';
            } else {
                return 'static new project --' + activeTemplate.slug;
            }
          }
        }" x-init="
          $refs.iframe.onload = function() {
            if(url != 'about:blank'){
                setTimeout(function(){
                    console.log('ready');
                    iframeReady = true;
                }, 300);
            }
          };
          $watch('templatePreview', function(value){
            if(value){
                document.body.classList.add('overflow-hidden');
            } else {
                iframeReady = false;
                url = 'about:blank';
                document.body.classList.remove('overflow-hidden');
            }
          });
          // .getElementById('x').onload= function() {
          //     ...
          // };
        " @show-template-preview.window="url=event.detail.url; templatePreview=true" 
        @keydown.escape.window="templatePreview = false"
        x-show="templatePreview" id="templates" class="z-[100] fixed inset-0 w-screen h-screen bg-black flex flex-col items-stretch" x-cloak>

    <div class="relative flex items-center z-20 justify-between w-screen border-b h-10 pb-0.5 bg-neutral-100 border-neutral-900">
        <div x-data="{ hovered: false }" :class="{ 'z-20' : hovered }" class="relative flex items-start h-full" x-cloak>

            <div  @mouseenter="hovered=true" @mouseleave="hovered=false" :class="{ 'shadow-lg rounded-br-md overflow-hidden' : hovered }" class="relative flex-shrink-0 block text-xs group text-neutral-600 w-36">
                <div class="flex items-center justify-between w-full h-10 px-3 bg-white cursor-pointer hover:bg-neutral-50 hover:text-neutral-900">
                    <div class="flex space-x-1.5 items-center justify-between">
                        <img class="w-3 h-3" :src="activeTemplate.favicon" />
                        <span x-text="activeTemplate.name"></span>
                    </div>
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4 opacity-60 group-hover:opacity-100">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M3 4.5h14.25M3 9h9.75M3 13.5h9.75m4.5-4.5v12m0 0l-3.75-3.75M17.25 21L21 17.25" />
                        </svg>
                    
                      
                </div>
                <div x-show="hovered"
                x-transition:enter="transition ease-out duration-200"
                x-transition:enter-start="opacity-50 -translate-y-1"
                x-transition:enter-end="opacity-100 translate-y-0">
                    <template x-for="template in templates" :key="template.slug">
                        <div @click="changeTheme(template.slug, template.url); hovered=false" :class="{ 'hidden' : activeTemplate.slug == template.slug, 'flex' : activeTemplate.slug != template.slug }" class="space-x-1.5 items-center w-full h-10 px-3 bg-white hover:bg-neutral-50 cursor-pointer hover:text-neutral-900">
                            <img class="w-3 h-3" :src="template.favicon" />
                            <span x-text="template.name"></span>
                        </div>
                    </template>
                </div>
            </div>

            <div class="relative bottom-0 left-0 z-20 flex-shrink-0 w-full px-5 py-2 leading-none" x-cloak>
                <code class="font-mono text-xs font-medium text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-pink-400 via-green-400">
                    <span x-text="templateInstallCommand"></span>
                </code>
            </div>
        </div>
        <div class="relative flex items-center h-full divide-x divide-neutral-200">
            <button @click="window.open(activeTemplate.repo, '_blank');" class="px-3 py-1 text-[0.65rem] font-medium space-x-1.5  h-full flex items-center hover:bg-white text-neutral-600 hover:text-neutral-900">
                <svg class="w-4 h-4 duration-300 ease-out -translate-y-px fill-current" viewBox="0 0 16 16" aria-hidden="true"><path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.012 8.012 0 0 0 16 8c0-4.42-3.58-8-8-8z"></path></svg>
                <span>View on Github</span>
            </button>
            <button @click="window.open(activeTemplate.url, '_blank');" class="px-3 py-1 text-[0.65rem] font-medium space-x-1  h-full flex items-center hover:bg-white text-neutral-600 hover:text-neutral-900">
                <span>Open in New Tab</span>
                <svg class="w-3.5 h-3.5 duration-100 ease-out fill-current" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><g fill="none" stroke="none"><path d="M10.25 4.75h-2.5a4 4 0 0 0-4 4v7.5a4 4 0 0 0 4 4h7.5a4 4 0 0 0 4-4V14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path><path d="M20.25 3.75v5.5m0-5.5h-5.5m5.5 0l-10.5 10.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"></path></g></svg>
            </button>
            <span class="flex items-center justify-center w-10 h-full cursor-pointer text-neutral-600 hover:text-neutral-900 hover:bg-white" @click="templatePreview=false">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
            </span>
        </div>
        <div class="absolute bottom-0 left-0 z-10 flex items-center translate-y-px w-full h-0.5">
            <div class="w-1/4 h-0.5 bg-gradient-to-r from-purple-500 via-teal-300 to-blue-500"></div>
            <div class="w-1/4 h-0.5 bg-gradient-to-r from-blue-500 via-pink-500 to-yellow-300"></div>
            <div class="w-1/4 h-0.5 bg-gradient-to-r from-yellow-300 via-purple-500 to-teal-300"></div>
            <div class="w-1/4 h-0.5 bg-gradient-to-r from-teal-300 via-blue-500 to-pink-500"></div>
        </div>
    </div>
    <iframe x-show="iframeReady" x-ref="iframe" :src="url" class="relative w-full h-full bg-white"></iframe>
    <div x-show="!iframeReady" class="fixed flex items-center justify-center w-screen h-screen">
        <svg class="w-5 h-5 text-white animate-spin" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
    </div>
</div>